version: 1.0
runtime: nodejs22

build:
  commands:
    build:
      - echo "Installing dependencies..."
      - npm ci
      - echo "Building the application..."
      - npm run build
      - echo "Build completed"

run:
  command: npm start
  network:
    port: 3000
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "3000"
    - name: AWS_REGION
      value: "us-east-1"
    - name: S3_BUCKET_NAME
      value: "yconic-autonomous"
    - name: S3_PUBLIC_BASE_URL
      value: "https://yconic-autonomous.s3.us-east-1.amazonaws.com/"
    - name: MAX_UPLOAD_MB
      value: "100"
    - name: ALLOWED_MIME_LIST
      value: "application/pdf,text/plain,text/markdown,application/vnd.openxmlformats-officedocument.wordprocessingml.document,text/calendar,text/csv,message/rfc822,application/mbox"
    - name: AUTH_USE_GOOGLE
      value: "false"
    - name: NEXTAUTH_URL
      value: "https://m3qknejspz.us-east-1.awsapprunner.com/"
  secrets:
    - name: NEXTAUTH_SECRET
      value-from: "arn:aws:secretsmanager:us-east-1:092639723477:secret:yconic/automation-K4mEUg:NEXTAUTH_SECRET::"
    - name: MONGODB_URI
      value-from: "arn:aws:secretsmanager:us-east-1:092639723477:secret:yconic/automation-K4mEUg:MONGODB_URI::"
    - name: MONGODB_TABLE
      value-from: "arn:aws:secretsmanager:us-east-1:092639723477:secret:yconic/automation-K4mEUg:MONGODB_TABLE::"
    - name: AWS_ACCESS_KEY_ID
      value-from: "arn:aws:secretsmanager:us-east-1:092639723477:secret:yconic/automation-K4mEUg:AWS_ACCESS_KEY_ID::"
    - name: AWS_SECRET_ACCESS_KEY
      value-from: "arn:aws:secretsmanager:us-east-1:092639723477:secret:yconic/automation-K4mEUg:AWS_SECRET_ACCESS_KEY::"
    